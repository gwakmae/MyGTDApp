@using MyGtdApp.Models

@if (SelectedTaskIds.Count > 1)
{
    <div class="bulk-edit-panel">
        <div class="panel-header">
            @* ğŸ”½ [FIX] '@SelectedTaskIds.Countê°œ' -> '@(SelectedTaskIds.Count)ê°œ'ë¡œ ìˆ˜ì • *@
            <h5 class="mb-0">@(SelectedTaskIds.Count)ê°œ í•­ëª© ì¼ê´„ í¸ì§‘</h5>
            <button type="button" class="btn-close" @onclick="ClosePanel"></button>
        </div>
        <div class="panel-body">
            <div class="edit-group">
                <label>ë§ˆê°ì¼ ë³€ê²½</label>
                <input type="date" class="form-control form-control-sm" 
                       @bind="_bulkUpdateModel.DueDate" />
            </div>

            <div class="edit-group">
                <label>ì¤‘ìš”ë„ ë³€ê²½</label>
                <select class="form-select form-select-sm" @bind="_bulkUpdateModel.Priority">
                    <option value="">-- ì„ íƒ ì•ˆ í•¨ --</option>
                    @foreach(var p in Enum.GetValues<Priority>())
                    {
                        <option value="@p">@p</option>
                    }
                </select>
            </div>

            <div class="edit-group">
                <label>ì»¨í…ìŠ¤íŠ¸ ì¶”ê°€</label>
                @* ğŸ”½ [FIX] '@FollowUp' -> '@@FollowUp' (ì´ì¤‘ @ ê¸°í˜¸ë¡œ ì´ìŠ¤ì¼€ì´í”„) *@
                <input type="text" class="form-control form-control-sm" 
                       placeholder="ì˜ˆ: @@FollowUp"
                       @bind="_bulkUpdateModel.ContextToAdd" />
            </div>

            <div class="edit-group">
                <label>ì»¨í…ìŠ¤íŠ¸ ì œê±°</label>
                @* ğŸ”½ [FIX] '@Waiting' -> '@@Waiting' (ì´ì¤‘ @ ê¸°í˜¸ë¡œ ì´ìŠ¤ì¼€ì´í”„) *@
                <input type="text" class="form-control form-control-sm"
                       placeholder="ì˜ˆ: @@Waiting"
                       @bind="_bulkUpdateModel.ContextToRemove" />
            </div>
        </div>
        <div class="panel-footer">
            <button class="btn btn-primary btn-sm" @onclick="ApplyChanges">ì¼ê´„ ì ìš©</button>
            <button class="btn btn-secondary btn-sm" @onclick="ClosePanel">ì·¨ì†Œ</button>
        </div>
    </div>
}


@code {
    [Parameter]
    public List<int> SelectedTaskIds { get; set; } = new();

    [Parameter]
    public EventCallback<BulkUpdateModel> OnApply { get; set; }

    [Parameter]
    public EventCallback OnClose { get; set; }

    private BulkUpdateModel _bulkUpdateModel = new();

    protected override void OnParametersSet()
    {
        if (SelectedTaskIds.Any())
        {
            _bulkUpdateModel = new BulkUpdateModel { TaskIds = new List<int>(SelectedTaskIds) };
        }
    }

    private Task ApplyChanges() => OnApply.InvokeAsync(_bulkUpdateModel);

    private Task ClosePanel() => OnClose.InvokeAsync();
}